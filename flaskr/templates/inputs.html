{% extends "master.html" %}

{% block title %} Data Analysis {% endblock %}

{% block body %}
<style>
    p.big {
        line-height: 8px;
    }

    p.huge {
        line-height: 16px;
    }

</style>


<br>
<div class="formwrapper">
    <form method=post>

        <table>
            <thead>
            <tr>
                <th> Type</th>
                <th> Component</th>
                <th> Quantity</th>
                <th> Unit</th>
            </tr>
            </thead>

            <tbody id="componenttable">
            <div id="template">
                <th><p id="typefield"></p><select id="typetemplate" name="Type0" onchange="refreshNames('Buffer')">
                        {% for type, names in components.items() %}
                        {% set selectedtype = type %}
                        <option value={{type}}>{{type}}</option>
                        {% endfor %}
                    </select><br></th>
                <th><p id="namefield"></p><select id="nametemplate" name="Component0" >
                        {% for name in components[selectedtype] %}
                        <option value={{name}}>{{name}}</option>
                        {% endfor %}
                    </select><br></th>
                <th><p id="quantityfield"></p><input id="quantitytemplate" name="Quantity0" type="number"/><br></th>
                <th><p id="unitfield"></p><input id="unittemplate" name="Unit0" type="text"/><br></th>
            </div>

            </tbody>

            <tfooter>
                <tr>
                    <td><br>
                        <input onclick="addOne('component')" type="button" value="Add a Component"/>
                    </td>
                </tr>
            </tfooter>
        </table>

        <p class="big">

            Custom Label Addition:
            <input name="customlabel" type="text"/><br>
        <p class="big">

        <table id="grouptable">
            <thead>
            <tr><th> Group Label </th>
                <th> Number of Wells </th>
                <th> Number of Samples </th></tr>
            </thead>

            <tbody>
            <th><p id="grouplabelfield">
                    <input id="grouplabeltemplate" name="Group Label 0" type="text"/>
                </p></th>
            <th><p id="groupwellfield">
                    <input id="groupwelltemplate" name="Group Wells 0" type="number"/>
                </p></th>
            <th><p id="groupsamplefield">
                    <input id="groupsampletemplate" name="Group Samples 0" type="number"/>
            </p></th>
            </tbody>

            <tfooter>
                <tr><td><br>
                        <input onclick="addOne('group')" type="button" value="Add a Group"/><br>
                    </td></tr>
            </tfooter>
        </table>
        If no groups are entered, we will attempt to automatically differentiate them

        <p class="big">

        <p class="huge"><br>
            <b> Optional parameters:</b><br>
        <p class="big">


        <table id="swaptable"><h>Swaps</h>
            <thead>
            <tr><th> From</th>
                <th> To</th>
                <th> Make Bidirectional</th></tr>
            </thead>

            <tbody>
            <th><p id="swapfromfield">
                    <input id="swapfromtemplate" name="Swap From 0" placeholder="A01" type="text"/>
                </p></th>
            <th><p id="swaptofield">
                    <input id="swaptotemplate" name="Swap To 0" placeholder="D01" type="text"/>
                </p></th>
            <th><td><p id="bidirectionalfield">
                <input id="bidirectionaltemplate" name="Bidirectional Swap 0" type="checkbox"/>
                </p></td></th>
            </tbody>

            <tfooter>
                <tr><td><br>
                        <input onclick="addOne('swap')" type="button" value="Add a Swap"/><br>
                    </td></tr>
            </tfooter>
        </table>

        <p class="big">
            Any wells with known errors
            <input name="errorwells" placeholder="A01, A02, ..." type="text"><br>
            <br>
            Fluorescence Error Cut Time
            <input name="cutlength" placeholder="default=0" type="text"/><br>
        <p class="big">

        <p><input name='Run' type="submit" value="Run analysis"/></p>

        <th id="startcol"><br id="breakdiv"></th></p>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script type="text/javascript">
    function addOne(type) {
        switch (type) {
            case 'component' :
                clone('typetemplate', 'typefield');
                clone('nametemplate', 'namefield');
                clone('quantitytemplate', 'quantityfield');
                clone('unittemplate', 'unitfield');

                refreshNames('Target')
                break;
            case 'group':
                clone('grouplabeltemplate', 'grouplabelfield');
                clone('groupwelltemplate', 'groupwellfield');
                clone('groupsampletemplate', 'groupsamplefield');
                break;
            case 'swap':
                clone('swapfromtemplate', 'swapfromfield');
                clone('swaptotemplate', 'swaptofield');
                clone('bidirectionaltemplate', 'bidirectionalfield');
                break;
        }
    }


    function clone(templatename, fieldname) {
        itm = document.getElementById(templatename);
        lastPosition = itm.name.toString().length-1;
        increment = parseFloat(itm.name.toString().charAt(lastPosition));
        itm.name = itm.name.toString().substring(0,lastPosition) + (increment + 1);
        // itm.id = itm.id.toString().substring(0,lastPosition) + (increment + 1);

        br = document.getElementById('breakdiv');
        document.getElementById(fieldname).append(br.cloneNode());
        document.getElementById(fieldname).append(itm.cloneNode());
    }

    function refreshNames(type) {
        var componenttypes = {{ components | tojson }};
        componenttypes[type].forEach(function(name){
            $('#nametemplate').append("<option>" + name + "</option>");
        });
    }

</script>


{% endblock %}

{% block content %}{% endblock %}

{% block buttons %}
<a href="{{ url_for('.search', id=id) }}">
    <button>Back</button>
</a>
{% endblock %}

